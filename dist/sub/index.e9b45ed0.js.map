{"mappings":"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","sources":["<anon>","src/sub/js/index.js","src/sub/js/subscriber.js","src/js/member.js"],"sourcesContent":["var $parcel$global =\ntypeof globalThis !== 'undefined'\n  ? globalThis\n  : typeof self !== 'undefined'\n  ? self\n  : typeof window !== 'undefined'\n  ? window\n  : typeof global !== 'undefined'\n  ? global\n  : {};\nvar $parcel$modules = {};\nvar $parcel$inits = {};\n\nvar parcelRequire = $parcel$global[\"parcelRequire87e6\"];\nif (parcelRequire == null) {\n  parcelRequire = function(id) {\n    if (id in $parcel$modules) {\n      return $parcel$modules[id].exports;\n    }\n    if (id in $parcel$inits) {\n      var init = $parcel$inits[id];\n      delete $parcel$inits[id];\n      var module = {id: id, exports: {}};\n      $parcel$modules[id] = module;\n      init.call(module.exports, module, module.exports);\n      return module.exports;\n    }\n    var err = new Error(\"Cannot find module '\" + id + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n  };\n\n  parcelRequire.register = function register(id, init) {\n    $parcel$inits[id] = init;\n  };\n\n  $parcel$global[\"parcelRequire87e6\"] = parcelRequire;\n}\nparcelRequire(\"hlpVk\");\n\nvar $hlpVk = parcelRequire(\"hlpVk\");\n\nvar $aohA3 = parcelRequire(\"aohA3\");\nconst $cd9376191bc66ab5$var$memberPrototype = {\n    initMyContext: async function(key) {\n        const context = await (0, $hlpVk.SkyWayContext).Create((0, $aohA3.getToken)(key));\n        const room = await (0, $hlpVk.SkyWayRoom).FindOrCreate(context, {\n            type: \"p2p\",\n            name: this.roomName\n        });\n        const myInfo = await room.join();\n        this.myInfo = myInfo;\n        this.myRoom = room;\n    },\n    leaveRoom: async function() {\n        const leaveRoom = await this.myRoom.leave(this.myInfo);\n        console.log(\"leave\");\n    }\n};\nfunction $cd9376191bc66ab5$export$3b8335eaeaa275bb(roomName) {\n    this.roomName = roomName;\n}\nObject.assign($cd9376191bc66ab5$export$3b8335eaeaa275bb.prototype, $cd9376191bc66ab5$var$memberPrototype);\n\n\nconst $bfc63e8ec7f39df9$var$subscriberPrototype = {\n    subscribeAndAttach: function(publication) {\n        console.log(publication.publisher.id);\n        console.log(this.myInfo);\n        if (publication.publisher.id === this.myInfo.id) return;\n        const subscribeButton = document.createElement(\"button\");\n        subscribeButton.textContent = `${publication.publisher.id}: ${publication.contentType}`;\n        this.buttonArea.appendChild(subscribeButton);\n        subscribeButton.onclick = async ()=>{\n            const { stream: stream } = await this.myInfo.subscribe(publication.id);\n            let newMedia;\n            switch(stream.track.kind){\n                case \"video\":\n                    newMedia = document.getElementById(\"video\");\n                    break;\n                case \"audio\":\n                    newMedia = document.createElement(\"audio\");\n                    newMedia.controls = true;\n                    newMedia.autoplay = true;\n                    break;\n                default:\n                    return;\n            }\n            stream.attach(newMedia);\n            this.remoteMediaArea.appendChild(newMedia);\n        };\n    }\n};\nfunction $bfc63e8ec7f39df9$export$60959659b2c22881(roomName, buttonArea, remoteMediaArea) {\n    (0, $cd9376191bc66ab5$export$3b8335eaeaa275bb).call(this, roomName);\n    this.buttonArea = buttonArea;\n    this.remoteMediaArea = remoteMediaArea;\n}\n$bfc63e8ec7f39df9$export$60959659b2c22881.prototype = Object.create((0, $cd9376191bc66ab5$export$3b8335eaeaa275bb).prototype);\n$bfc63e8ec7f39df9$export$60959659b2c22881.prototype.constructor = $bfc63e8ec7f39df9$export$60959659b2c22881;\nObject.assign($bfc63e8ec7f39df9$export$60959659b2c22881.prototype, $bfc63e8ec7f39df9$var$subscriberPrototype);\n\n\nconst $92ed5bd805a8fa7b$var$myId = document.getElementById(\"my-id\");\nconst $92ed5bd805a8fa7b$var$leaveButton = document.getElementById(\"leave-button\");\nconst $92ed5bd805a8fa7b$var$listButton = document.getElementById(\"list-button\");\nconst $92ed5bd805a8fa7b$var$buttonArea = document.getElementById(\"button-area\");\nconst $92ed5bd805a8fa7b$var$remoteMediaArea = document.getElementById(\"remote-media-area\");\n(async ()=>{\n    const searchParams = new URLSearchParams(window.location.search);\n    const me = new (0, $bfc63e8ec7f39df9$export$60959659b2c22881)(searchParams.get(\"room\"), $92ed5bd805a8fa7b$var$buttonArea, $92ed5bd805a8fa7b$var$remoteMediaArea);\n    await me.initMyContext(searchParams.get(\"key\"));\n    $92ed5bd805a8fa7b$var$myId.textContent = me.myInfo.id;\n    me.myRoom.publications.forEach((publication)=>{\n        me.subscribeAndAttach(publication);\n    });\n    $92ed5bd805a8fa7b$var$leaveButton.onclick = async ()=>{\n        me.leaveRoom();\n        $92ed5bd805a8fa7b$var$myId.textContent = \"leaved\";\n    };\n})();\n\n\n//# sourceMappingURL=index.e9b45ed0.js.map\n","import { Subscriber } from './subscriber';\r\n\r\nconst myId            = document.getElementById('my-id');\r\nconst leaveButton     = document.getElementById('leave-button');\r\nconst listButton      = document.getElementById('list-button');\r\nconst buttonArea      = document.getElementById('button-area');\r\nconst remoteMediaArea = document.getElementById('remote-media-area');\r\n\r\n(async () => {\r\n\r\n  const searchParams = new URLSearchParams(window.location.search);\r\n  const me = new Subscriber(searchParams.get('room'), buttonArea, remoteMediaArea);\r\n  await me.initMyContext(searchParams.get('key'));\r\n\r\n  myId.textContent = me.myInfo.id;\r\n\r\n  me.myRoom.publications.forEach(publication => {\r\n    me.subscribeAndAttach(publication);\r\n  });\r\n\r\n  leaveButton.onclick = async () => {\r\n    me.leaveRoom();\r\n    myId.textContent = \"leaved\";\r\n  };\r\n\r\n})();","import { nowInSec, SkyWayAuthToken, SkyWayContext, SkyWayRoom, SkyWayStreamFactory, uuidV4 } from '@skyway-sdk/room';\r\nimport { Member } from '../../js/member';\r\n\r\nconst subscriberPrototype = {\r\n\r\n  subscribeAndAttach: function (publication) {\r\n    console.log(publication.publisher.id);\r\n    console.log(this.myInfo);\r\n    if (publication.publisher.id === this.myInfo.id) return;\r\n    \r\n    const subscribeButton = document.createElement('button');\r\n    subscribeButton.textContent = `${publication.publisher.id}: ${publication.contentType}`;\r\n\r\n    this.buttonArea.appendChild(subscribeButton);\r\n\r\n    subscribeButton.onclick = async() => {\r\n      const { stream } = await this.myInfo.subscribe(publication.id);\r\n\r\n      let newMedia;\r\n      switch (stream.track.kind) {\r\n        case 'video':\r\n          newMedia = document.getElementById('video');\r\n          break;\r\n        case 'audio':\r\n          newMedia = document.createElement('audio');\r\n          newMedia.controls = true;\r\n          newMedia.autoplay = true;\r\n          break;  \r\n        default:\r\n          return;\r\n      }\r\n      stream.attach(newMedia);\r\n      this.remoteMediaArea.appendChild(newMedia);\r\n    }\r\n  },\r\n\r\n}\r\n\r\nexport function Subscriber(roomName, buttonArea, remoteMediaArea) {\r\n  Member.call(this, roomName);\r\n  this.buttonArea = buttonArea;\r\n  this.remoteMediaArea = remoteMediaArea;\r\n}\r\n\r\nSubscriber.prototype = Object.create(Member.prototype);\r\nSubscriber.prototype.constructor = Subscriber;\r\n\r\nObject.assign(Subscriber.prototype, subscriberPrototype);","import { SkyWayContext, SkyWayRoom } from '@skyway-sdk/room';\r\nimport { getToken } from './generateToken';\r\n\r\nconst memberPrototype = {\r\n  initMyContext: async function (key) {\r\n    const context = await SkyWayContext.Create(getToken(key));\r\n    const room = await SkyWayRoom.FindOrCreate(context, {\r\n      type: 'p2p',\r\n      name: this.roomName,\r\n    });\r\n    const myInfo = await room.join();\r\n    this.myInfo = myInfo;\r\n    this.myRoom = room;\r\n  },\r\n\r\n  leaveRoom: async function () {\r\n    const leaveRoom = await this.myRoom.leave(this.myInfo);\r\n    console.log('leave');\r\n  },\r\n};\r\n\r\nexport function Member(roomName) {\r\n  this.roomName = roomName;\r\n}\r\n\r\nObject.assign(Member.prototype, memberPrototype);"],"names":["$parcel$global","globalThis","self","window","global","$parcel$modules","$parcel$inits","parcelRequire","id","exports","init","module","call","err","Error","code","register","$hlpVk","$aohA3","$cd9376191bc66ab5$export$3b8335eaeaa275bb","roomName","$bfc63e8ec7f39df9$export$60959659b2c22881","buttonArea","remoteMediaArea","Object","assign","prototype","initMyContext","key","context","SkyWayContext","Create","getToken","room","SkyWayRoom","FindOrCreate","type","name","myInfo","join","myRoom","leaveRoom","leave","console","log","create","constructor","subscribeAndAttach","publication","publisher","subscribeButton","document","createElement","textContent","contentType","appendChild","onclick","newMedia","stream","subscribe","track","kind","getElementById","controls","autoplay","attach","$92ed5bd805a8fa7b$var$myId","$92ed5bd805a8fa7b$var$leaveButton","$92ed5bd805a8fa7b$var$buttonArea","$92ed5bd805a8fa7b$var$remoteMediaArea","searchParams","URLSearchParams","location","search","me","get","publications","forEach"],"version":3,"file":"index.e9b45ed0.js.map"}